
// ■■■■■■ ■■■■■■■■■■■■■■■■■■■■■■■■ ■■■■■■■■■■■■■■■■■■■■■■■■ 
// ■■■■■■ ■■■■■■■多指標標記系統■■■■■■■ ■■■■■■■■■■■■■■■■■■■■■■■■ 
// ■■■■■■ ■■■■■■■■■■■■■■■■■■■■■■■■ ■■■■■■■■■■■■■■■■■■■■■■■■

//@version=6
indicator("多指標標記系統", overlay=true)

// ■■■■■■ MACD 計算 ■■■■■■
fast_length = input(title = "Fast Length", defval = 12)
slow_length = input(title = "Slow Length", defval = 26)
signal_length = input(title = "Signal Smoothing", defval = 9)
src = input(title = "Source", defval = close)

fast_ma = ta.ema(src, fast_length)
slow_ma = ta.ema(src, slow_length)
macd = fast_ma - slow_ma
signal = ta.ema(macd, signal_length)

// ■■■■■■ 三個指標計算（布林值輸出）■■■■■■
// i. 快線上穿慢線
macd_crossover = ta.crossover(macd, signal)

// ii. 快線下穿慢線  
macd_crossunder = ta.crossunder(macd, signal)

// iii. 連續三根上漲
three_rising = close > close[1] and close[1] > close[2] and close[2] > close[3]

// ■■■■■■ A指標 紅色鑽石標記 設定 ■■■■■■
group_a = "A指標 紅色鑽石標記"
a_enable = input.bool(title="啟用A指標", defval=false, group=group_a)
a_condition = input.string(title="選擇條件", 
     defval="快線上穿慢線", 
     options=["快線上穿慢線", "快線下穿慢線", "連續三根上漲"], 
     group=group_a)

// ■■■■■■ B指標 藍色旗幟標記 設定 ■■■■■■
group_b = "B指標 藍色旗幟標記"
b_enable = input.bool(title="啟用B指標", defval=false, group=group_b)
b_condition = input.string(title="選擇條件", 
     defval="快線下穿慢線", 
     options=["快線上穿慢線", "快線下穿慢線", "連續三根上漲"], 
     group=group_b)

// ■■■■■■ C指標 綠色三角標記 設定 ■■■■■■
group_c = "C指標 綠色三角標記"
c_enable = input.bool(title="啟用C指標", defval=false, group=group_c)
c_condition = input.string(title="選擇條件", 
     defval="連續三根上漲", 
     options=["快線上穿慢線", "快線下穿慢線", "連續三根上漲"], 
     group=group_c)

// ■■■■■■ 條件判斷函數 ■■■■■■
get_condition(condition_name) =>
    switch condition_name
        "快線上穿慢線" => macd_crossover
        "快線下穿慢線" => macd_crossunder  
        "連續三根上漲" => three_rising
        => false

// ■■■■■■ A指標觸發條件 ■■■■■■
a_trigger = a_enable and get_condition(a_condition)

// ■■■■■■ B指標觸發條件 ■■■■■■
b_trigger = b_enable and get_condition(b_condition)

// ■■■■■■ C指標觸發條件 ■■■■■■
c_trigger = c_enable and get_condition(c_condition)

// ■■■■■■ 標記顯示 ■■■■■■
// A指標 紅色鑽石標記
plotshape(a_trigger, 
     style=shape.diamond, 
     location=location.belowbar, 
     color=color.red, 
     size=size.normal,
     title="A指標 紅色鑽石")

// B指標 藍色旗幟標記
plotshape(b_trigger, 
     style=shape.flag, 
     location=location.abovebar, 
     color=color.blue, 
     size=size.normal,
     title="B指標 藍色旗幟")

// C指標 綠色三角標記
plotshape(c_trigger, 
     style=shape.triangleup, 
     location=location.belowbar, 
     color=color.green, 
     size=size.normal,
     title="C指標 綠色三角")

// ■■■■■■ 警報設定 ■■■■■■
alertcondition(a_trigger, title="A指標觸發", message="A指標 紅色鑽石標記觸發: {{a_condition}}")
alertcondition(b_trigger, title="B指標觸發", message="B指標 藍色旗幟標記觸發: {{b_condition}}")
alertcondition(c_trigger, title="C指標觸發", message="C指標 綠色三角標記觸發: {{c_condition}}")

// ■■■■■■ 資訊顯示 ■■■■■■
var table info_table = table.new(position.top_right, 2, 4, bgcolor=color.white, border_width=1)

if barstate.islast
    table.cell(info_table, 0, 0, "指標", text_color=color.black, bgcolor=color.gray)
    table.cell(info_table, 1, 0, "條件", text_color=color.black, bgcolor=color.gray)
    
    table.cell(info_table, 0, 1, "A指標 🔴", text_color=color.red, bgcolor=color.white)
    table.cell(info_table, 1, 1, a_enable ? a_condition : "未啟用", text_color=color.black, bgcolor=color.white)
    
    table.cell(info_table, 0, 2, "B指標 🔵", text_color=color.blue, bgcolor=color.white)
    table.cell(info_table, 1, 2, b_enable ? b_condition : "未啟用", text_color=color.black, bgcolor=color.white)
    
    table.cell(info_table, 0, 3, "C指標 🟢", text_color=color.green, bgcolor=color.white)
    table.cell(info_table, 1, 3, c_enable ? c_condition : "未啟用", text_color=color.black, bgcolor=color.white)


